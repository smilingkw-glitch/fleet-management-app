<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini Fleet â€” Admin Dashboard</title>
  <style>
    :root{ --accent:#ff6b00; --muted:#666; --card-bg:#fff; }
    body{ margin:0; font-family: Arial, sans-serif; background:#f4f6f8; }
    header{ background:var(--card-bg); padding:12px 20px; box-shadow:0 2px 6px rgba(0,0,0,0.06); display:flex; align-items:center; gap:16px; justify-content:space-between;}
    .brand{ font-weight:700; color:var(--accent); }
    .filters{ display:flex; gap:8px; align-items:center; }
    select, button.filter-btn { padding:8px; border:1px solid #ddd; border-radius:6px; background:white; }
    .container{ display:flex; gap:16px; padding:16px; max-width:1200px; margin:18px auto; box-sizing:border-box; }
    .sidebar{ width:300px; background:var(--card-bg); padding:16px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.04); }
    .main{ flex:1; background:transparent; }
    label{ display:block; margin-top:12px; font-size:14px; color:var(--muted); }
    input[type="text"], select, input[type="checkbox"]{ width:100%; padding:8px; margin-top:6px; box-sizing:border-box; border:1px solid #ddd; border-radius:6px; }
    .btn { margin-top:12px; padding:10px; border-radius:6px; border:none; background:var(--accent); color:white; cursor:pointer; font-weight:600; width:100%; }
    .cards{ display:flex; flex-wrap:wrap; gap:12px; }
    .card{ width:calc(33.333% - 8px); background:var(--card-bg); border-radius:8px; padding:12px; box-shadow:0 4px 10px rgba(0,0,0,0.04); box-sizing:border-box; }
    .card img{ width:100%; height:120px; object-fit:cover; border-radius:6px; }
    .card h4{ margin:10px 0 6px; }
    .meta{ font-size:13px; color:var(--muted); margin-bottom:8px; }
    .card .actions{ display:flex; gap:8px; justify-content:space-between; margin-top:8px; }
    .small-btn{ padding:6px 8px; font-size:13px; border-radius:6px; border:1px solid #ddd; cursor:pointer; background:white; }
    @media (max-width:900px){ .card{ width:calc(50% - 8px); } .sidebar{ width:260px; } }
    @media (max-width:600px){ .container{ flex-direction:column; } .card{ width:100%; } .sidebar{ width:100%; } header{ flex-wrap:wrap; } }
    .notice{ font-size:13px; color:#444; margin-top:6px; }
  </style>
</head>
<body>
  <header>
    <div class="brand">Mini Fleet Admin</div>
    <div class="filters">
      <label style="margin:0 8px 0 0; font-size:13px; color:#333;">Category</label>
      <select id="filterCategory">
        <option value="All">All</option>
        <option>Auto</option>
        <option>Car</option>
        <option>Truck</option>
        <option>Bus</option>
      </select>

      <label style="margin:0 8px 0 12px; font-size:13px; color:#333;">Availability</label>
      <select id="filterAvailability">
        <option value="All">All</option>
        <option>Available</option>
        <option>Unavailable</option>
      </select>

      <button class="filter-btn" id="clearFilterBtn">Clear Filter</button>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar">
      <h3>Fleet Form</h3>
      <label for="regNo">Reg No of Vehicle</label>
      <input id="regNo" type="text" placeholder="e.g., MH12AB1234" />

      <label for="category">Category</label>
      <select id="category">
        <option value="">Select Category</option>
        <option>Auto</option>
        <option>Car</option>
        <option>Truck</option>
        <option>Bus</option>
      </select>

      <label for="driverName">Driver Name</label>
      <input id="driverName" type="text" placeholder="Driver name" />

      <label style="display:flex;align-items:center;gap:8px;margin-top:12px;">
        <input id="isAvailable" type="checkbox" /> Available
      </label>

      <button class="btn" id="addFleetBtn">Add Fleet</button>
      <div class="notice">Layout: cards in main content (3 per row). Required fields must be filled.</div>
    </aside>

    <main class="main">
      <div id="cardsContainer" class="cards"></div>
    </main>
  </div>

  <script>
    // Use localStorage to persist fleets
    const STORAGE_KEY = 'fleets_v1';

    // default sample image for all vehicles (assignment mentions sample link)
    const SAMPLE_IMG = 'https://coding-platform.s3.amazonaws.com/dev/lms/tickets/5e80fcb6-3f8e-480c-945b-30a5359eb40e/JNmYjkVr3WOjsrbu.png';

    // load fleets or default empty array
    let fleets = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

    // DOM refs
    const regNoEl = document.getElementById('regNo');
    const categoryEl = document.getElementById('category');
    const driverNameEl = document.getElementById('driverName');
    const isAvailableEl = document.getElementById('isAvailable');
    const addFleetBtn = document.getElementById('addFleetBtn');
    const cardsContainer = document.getElementById('cardsContainer');

    const filterCategory = document.getElementById('filterCategory');
    const filterAvailability = document.getElementById('filterAvailability');
    const clearFilterBtn = document.getElementById('clearFilterBtn');

    // helper to save
    function saveFleets() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(fleets));
    }

    // render function with optional filters
    function render() {
      const catFilter = filterCategory.value;
      const availFilter = filterAvailability.value;
      cardsContainer.innerHTML = '';

      // apply filters
      const toShow = fleets.filter(f => {
        let ok = true;
        if (catFilter && catFilter !== 'All') ok = ok && (f.category === catFilter);
        if (availFilter && availFilter !== 'All') ok = ok && ((f.isAvailable ? 'Available' : 'Unavailable') === availFilter);
        return ok;
      });

      if (toShow.length === 0) {
        cardsContainer.innerHTML = '<div style="padding:12px;color:#555">No vehicles found.</div>';
        return;
      }

      toShow.forEach((f, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${SAMPLE_IMG}" alt="vehicle"/>
          <h4>${escapeHtml(f.regNo)}</h4>
          <div class="meta">
            <div><strong>Category:</strong> ${escapeHtml(f.category)}</div>
            <div><strong>Driver:</strong> ${escapeHtml(f.driverName)}</div>
            <div><strong>Availability:</strong> <span id="avail-${f.id}">${f.isAvailable ? 'Available' : 'Unavailable'}</span></div>
          </div>
          <div class="actions">
            <button class="small-btn" data-action="update" data-id="${f.id}">Update Driver</button>
            <button class="small-btn" data-action="toggle" data-id="${f.id}">Change Availability</button>
            <button class="small-btn" data-action="delete" data-id="${f.id}">Delete Vehicle</button>
          </div>
        `;
        cardsContainer.appendChild(card);
      });
    }

    // add fleet
    addFleetBtn.addEventListener('click', function() {
      const regNo = regNoEl.value.trim();
      const category = categoryEl.value;
      const driverName = driverNameEl.value.trim();
      const isAvailable = isAvailableEl.checked;

      // validation
      if (!regNo) { alert('Reg No is required'); return; }
      if (!category) { alert('Select category'); return; }
      if (!driverName) { alert('Driver name is required'); return; }

      // create object
      const newFleet = {
        id: Date.now().toString(),
        regNo, category, driverName, isAvailable
      };
      fleets.push(newFleet);
      saveFleets();
      clearForm();
      applyFiltersAndRender();
    });

    // clear form inputs
    function clearForm() {
      regNoEl.value = '';
      categoryEl.value = '';
      driverNameEl.value = '';
      isAvailableEl.checked = false;
    }

    // handle card actions using event delegation
    cardsContainer.addEventListener('click', function(e) {
      const btn = e.target.closest('button');
      if (!btn) return;
      const action = btn.dataset.action;
      const id = btn.dataset.id;
      if (action === 'update') {
        const fleet = fleets.find(x => x.id === id);
        if (!fleet) return;
        const newName = prompt('Enter new driver name:', fleet.driverName);
        if (newName === null) return; // cancelled
        if (newName.trim() === '') { alert('Driver name cannot be empty.'); return; }
        fleet.driverName = newName.trim();
        saveFleets();
        applyFiltersAndRender();
      } else if (action === 'toggle') {
        const fleet = fleets.find(x => x.id === id);
        if (!fleet) return;
        fleet.isAvailable = !fleet.isAvailable;
        saveFleets();
        applyFiltersAndRender();
      } else if (action === 'delete') {
        const confirmDelete = confirm('Are you sure you want to delete this vehicle?');
        if (!confirmDelete) return;
        fleets = fleets.filter(x => x.id !== id);
        saveFleets();
        applyFiltersAndRender();
      }
    });

    // filters
    filterCategory.addEventListener('change', applyFiltersAndRender);
    filterAvailability.addEventListener('change', applyFiltersAndRender);
    clearFilterBtn.addEventListener('click', function() {
      filterCategory.value = 'All';
      filterAvailability.value = 'All';
      applyFiltersAndRender();
    });

    function applyFiltersAndRender() {
      // render uses current filter values
      render();
    }

    // utility to prevent XSS in text shown
    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, function(m) {
        return ({
          '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;'
        })[m];
      });
    }

    // initial render
    applyFiltersAndRender();
  </script>
</body>
</html>
